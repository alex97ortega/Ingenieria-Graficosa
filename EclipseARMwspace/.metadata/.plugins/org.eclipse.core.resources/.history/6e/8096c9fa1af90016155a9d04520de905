

/*-----------------------------------------------------------------
**
**  Fichero:
**    misc.asm  10/6/2014
**
**    Estructura de Computadores
**    Dpto. de Arquitectura de Computadores y Automática
**    Facultad de Informática. Universidad Complutense de Madrid
**
**  Propósito:
**    Contiene las implementaciones de las funciones en ensamblador
**    usadas por el programa principal
**
**  Notas de diseño:
**
**---------------------------------------------------------------*/
.global


.text


rgb2grayASM: push{r4, r5, r6, fp, lr}
			add fp, sp, #16
			mul r4, r0, #2126
			mul r5, r1, #7152
			mul r6, r2, #722
			add r4, r4, r5
			add r6, r6, r4      // r6 = numerator.
			mov r0, r6;         //we pass the numerator as a parameter to the subroutine.
			bl div16384
			pop{r4, r5, r6, fp, lr}
			mov pc, lr



div16384: push{r4, r5, fp}
		add fp, sp, #8
		mov r5, r0
		mov r4, #0       //r4 = i
For:    cmp r4, #14		//2^14 = 16384
		beq endFor
		ldr r5, [r5, lsr#2]     //divide by two 14 times.
		b For
endFor: mov r0, r5
		pop{r4, r5, fp}
		mov pc, lr



